<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stress-Strain Plotter</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <p class="eyebrow">Materials Lab</p>
        <h1>Stress-Strain Curve</h1>
        <p class="subtitle">
          Paste a comma-separated list of numeric pairs (strain, stress) or
          upload a data file to plot your curve.
        </p>
      </header>

      <main class="content">
        <section class="panel">
          <div class="file-block">
            <label for="fileInput" title="Upload a CSV/TSV/TXT file with strain, stress columns.">Upload stress-strain file</label>
            <input id="fileInput" type="file" accept=".csv,.txt" title="Upload a CSV/TSV/TXT file with strain, stress columns." />
            <p class="file-helper">CSV/TSV or TXT with comma- or tab-separated columns and one pair per line.</p>
          </div>

          <div class="file-block">
            <label title="Load a built-in reference dataset for comparison.">Reference dataset</label>
            <button id="referenceBtn" class="ghost" title="Load the Al2024-T351 reference dataset.">Load Al2024-T351 reference</button>
            <p id="referenceInfo" class="file-helper">Loads Al2024-T351.csv with its header row (MPa units).</p>
          </div>

          <div class="file-block">
            <label class="checkbox-row" title="Check if the first non-empty row is a header.">
              <input id="hasHeader" type="checkbox" title="Check if the first non-empty row is a header." />
              Data includes header row
            </label>
          </div>

          <div class="file-block">
            <label for="stressUnit" title="Select the units of the stress column.">Stress units</label>
            <select id="stressUnit" title="Select the units of the stress column.">
              <option value="Pa">Pa</option>
              <option value="MPa" selected>MPa</option>
              <option value="GPa">GPa</option>
            </select>
          </div>

          <div class="file-block">
            <label class="checkbox-row" title="Overlay the true stress-strain curve.">
              <input id="showTrue" type="checkbox" title="Overlay the true stress-strain curve." checked />
              Show true stress-strain
            </label>
          </div>

          <div class="file-block">
            <label title="Filter the plotted data by stress value.">Plot stress range</label>
            <div class="range-row">
              <input id="stressMin" type="number" step="any" placeholder="Min" title="Minimum stress to include." />
              <span>to</span>
              <input id="stressMax" type="number" step="any" placeholder="Max" title="Maximum stress to include." />
            </div>
            <div class="range-actions">
              <button id="applyRangeBtn" class="ghost" title="Apply the stress range filter.">Use range</button>
              <button id="clearRangeBtn" class="ghost" title="Clear the stress range filter.">Clear range</button>
            </div>
            <div class="range-actions">
              <button id="selectAllRangeBtn" class="ghost" title="Set the range to cover all data (overrides inputs).">Select all data</button>
              <button id="selectYieldRangeBtn" class="ghost" title="Set the range from the start up to the 0.2% yield stress.">Select to yield</button>
              <button id="selectUtsRangeBtn" class="ghost" title="Set the range from the start up to the UTS.">Select to UTS</button>
              <button id="selectPlasticRangeBtn" class="ghost" title="1) Read engineering strain/stress from file. 2) Find 0.2% yield. 3) Keep points from yield to UTS. 4) Convert to true strain/stress (etrue=ln(1+e), sigma_true=sigma(1+e)). 5) Fit a cubic to the true data and display R2.">Select plastic region</button>
            </div>
            <p class="file-helper">Leave blank for no limit (numeric values only).</p>
          </div>

          <div class="file-block">
            <label title="Select data rows by line number for regression.">Fit line range</label>
            <div class="range-row">
              <input id="lineFrom" type="number" step="1" min="1" placeholder="From" title="Start line number (data rows only)." />
              <span>to</span>
              <input id="lineTo" type="number" step="1" min="1" placeholder="To" title="End line number (data rows only)." />
            </div>
            <div class="range-actions">
              <button id="applyLineRangeBtn" class="ghost" title="Apply the line range for regression.">Use range</button>
              <button id="clearLineRangeBtn" class="ghost" title="Clear the line range.">Clear range</button>
            </div>
            <div class="range-actions">
              <button id="selectAllLineRangeBtn" class="ghost" title="Set line range to all data rows (overrides inputs).">Select all data</button>
              <button id="selectYieldLineRangeBtn" class="ghost" title="Set the line range from the start up to the 0.2% yield point.">Select to yield</button>
              <button id="selectUtsLineRangeBtn" class="ghost" title="Set the line range from the start up to the UTS.">Select to UTS</button>
              <button id="selectPlasticLineRangeBtn" class="ghost" title="1) Read engineering strain/stress from file. 2) Find 0.2% yield. 3) Keep points from yield to UTS. 4) Convert to true strain/stress (etrue=ln(1+e), sigma_true=sigma(1+e)). 5) Fit a cubic to the true data and display R2.">Select plastic region</button>
            </div>
            <p class="file-helper">Line numbers refer to data rows (header excluded).</p>
          </div>

          <div class="file-block">
            <label for="elasticModulusInput" title="Enter elastic modulus E (same units as stress) to compute plastic strain.">Elastic modulus E (for plastic strain)</label>
            <input
              id="elasticModulusInput"
              type="number"
              step="any"
              placeholder="e.g. 71000"
              title="Enter elastic modulus E (same units as stress) to compute plastic strain."
            />
            <p class="file-helper">Used to compute plastic strain: ep = etrue - sigma_true / E.</p>
          </div>

          <div class="file-block">
            <label class="checkbox-row" title="Overlay a theoretical Hollomon curve using E, yield, and UTS inputs.">
              <input id="showTheoretical" type="checkbox" title="Overlay a theoretical Hollomon curve using E, yield, and UTS inputs." />
              Show theoretical curve (Hollomon)
            </label>
          </div>

          <div class="file-block">
            <label for="theoryYield" title="Enter the 0.2% offset yield strength (same units as stress).">Yield strength (0.2% offset)</label>
            <input id="theoryYield" type="number" step="any" placeholder="e.g. 345" title="Enter the 0.2% offset yield strength (same units as stress)." />
            <label for="theoryUts" title="Enter ultimate tensile strength (same units as stress).">UTS (ultimate tensile strength)</label>
            <input id="theoryUts" type="number" step="any" placeholder="e.g. 470" title="Enter ultimate tensile strength (same units as stress)." />
            <label for="theoryUtsStrain" title="Enter the engineering strain at UTS; leave blank to assume 0.15.">Engineering strain at UTS (optional)</label>
            <input id="theoryUtsStrain" type="number" step="any" placeholder="e.g. 0.15" title="Enter the engineering strain at UTS; leave blank to assume 0.15." />
            <p id="theoryStatus" class="file-helper">Uses E above. If strain at UTS is blank, assumes 0.15.</p>
          </div>

          <div class="file-block">
            <label for="plasticStrainStep" title="Choose the strain increment for plastic region output.">Plastic output strain step</label>
            <input
              id="plasticStrainStep"
              type="number"
              step="any"
              min="0"
              placeholder="e.g. 0.005"
              title="Choose the strain increment for plastic region output."
            />
            <p class="file-helper">Generates true strain values from yield to UTS using this increment.</p>
          </div>

          <div class="file-block">
            <label for="plasticOutput" title="Computed true plastic strain and true stress for the selected plastic region.">Plastic region data (true plastic strain, true stress)</label>
            <textarea
              id="plasticOutput"
              rows="6"
              readonly
              title="Computed true plastic strain and true stress for the selected plastic region."
            ></textarea>
            <p class="file-helper">Shown when the plastic region is selected and E is provided.</p>
            <div class="range-actions">
              <button id="savePlasticBtn" class="ghost" title="Save the plastic region data to a CSV file.">Save plastic CSV</button>
            </div>
          </div>

          <label for="dataInput" title="Edit or paste strain, stress data here.">Stress-strain data (comma or tab separated)</label>
          <textarea
            id="dataInput"
            rows="6"
            placeholder="Example: 0,0, 0.01,120, 0.02,215, 0.03,290"
            title="Edit or paste strain, stress data here."
          ></textarea>
          <div class="data-table">
            <div class="table-header">
              <h4>Data table</h4>
              <p id="dataTableStatus">Awaiting data...</p>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th title="Data row number (header excluded).">#</th>
                    <th title="Engineering strain from the uploaded data.">Strain</th>
                    <th title="Engineering stress from the uploaded data.">Stress</th>
                    <th title="True strain: ln(1 + engineering strain).">True strain</th>
                    <th title="True stress: engineering stress × (1 + engineering strain).">True stress</th>
                    <th title="True plastic strain: true strain − true stress / E (requires E).">Plastic strain (true)</th>
                  </tr>
                </thead>
                <tbody id="dataTableBody"></tbody>
              </table>
            </div>
          </div>
          <div class="data-plot">
            <div class="table-header">
              <h4>Data column plot</h4>
              <div class="plot-selector">
                <label for="dataPlotSelect" title="Choose which column to plot against strain.">Plot</label>
                <select id="dataPlotSelect" title="Choose which column to plot against strain.">
                  <option value="stress">Stress</option>
                  <option value="trueStress">True stress</option>
                  <option value="trueStrain">True strain</option>
                  <option value="plasticStrain">Plastic strain (true)</option>
                  <option value="truePlasticStress">True plastic stress</option>
                  <option value="yieldRange">Data to Yield (0.2%)</option>
                  <option value="utsRange">Data up to UTS</option>
                  <option value="elasticFit">Elastic linear region (fit)</option>
                </select>
              </div>
              <div class="plot-selector">
                <label for="dataPlotFitSelect" title="Choose a regression overlay for the data column plot.">Regression</label>
                <select id="dataPlotFitSelect" title="Choose a regression overlay for the data column plot.">
                  <option value="none" selected>None</option>
                  <option value="linear">Linear</option>
                  <option value="quadratic">Quadratic</option>
                  <option value="cubic">Cubic</option>
                  <option value="exponential">Exponential</option>
                  <option value="loglog">Log-log</option>
                </select>
              </div>
            </div>
            <p id="dataPlotStatus">Awaiting data...</p>
            <div class="chart-shell">
              <svg id="dataPlotChart" viewBox="0 0 640 400" role="img" aria-label="Data column plot">
                <rect x="0" y="0" width="640" height="400" class="chart-bg" />
                <g id="dataPlotGrid"></g>
                <g id="dataPlotAxes"></g>
                <polyline id="dataPlotCurve" fill="none" stroke="#0f1a1a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                <polyline id="dataPlotFit" fill="none" stroke="#2e6bd9" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                <polyline id="dataPlotOffset" fill="none" stroke="#1d1a12" stroke-width="2" stroke-dasharray="4 6" stroke-linecap="round" stroke-linejoin="round" />
                <g id="dataPlotPoints"></g>
              </svg>
            </div>
          </div>
          <div class="actions">
            <button id="resetBtn" class="ghost" title="Reset inputs and plots.">Reset</button>
            <button id="summaryBtn" class="ghost" title="Show a summary of the current analysis.">Summary</button>
          </div>
          <p id="feedback" class="feedback" aria-live="polite"></p>
          <p id="selectionStatus" class="status">Fit source: auto-selection.</p>
          <p class="status">Legend: <span class="marker">>></span> = within stress range</p>
          <div class="notes">
            <span>Input rules:</span>
            <span>Use commas, tabs, or new lines between every number.</span>
            <span>Pairs are read as strain then stress.</span>
          </div>
        </section>

        <section class="panel chart-panel">
          <div class="chart-header">
            <div>
              <h2>Plot</h2>
              <p id="summary">Awaiting data...</p>
              <p id="yieldPointTop" class="modulus">Yield (0.2%): --</p>
              <p id="utsTop" class="modulus">UTS: --</p>
            </div>
            <div class="legend">
              <div class="legend-item">
                <span class="dot engineering"></span>
                <span>Engineering</span>
              </div>
              <div class="legend-item">
                <span class="dot true"></span>
                <span>True</span>
              </div>
              <div class="legend-item">
                <span class="dot theoretical"></span>
                <span>Theoretical</span>
              </div>
            </div>
          </div>

          <div class="chart-shell">
            <svg id="chart" viewBox="0 0 640 400" role="img" aria-label="Stress strain chart">
              <defs>
                <linearGradient id="lineGlow" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#0f1a1a" />
                  <stop offset="100%" stop-color="#d8722a" />
                </linearGradient>
                <linearGradient id="gridGlow" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#f6efe6" />
                  <stop offset="100%" stop-color="#e8dcc9" />
                </linearGradient>
              </defs>
              <rect x="0" y="0" width="640" height="400" class="chart-bg" />
              <g id="grid"></g>
              <g id="axes"></g>
              <polyline id="curve" fill="none" stroke="url(#lineGlow)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="trueCurve" fill="none" stroke="#1d1a12" stroke-width="2.5" stroke-dasharray="6 6" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="theoreticalCurve" fill="none" stroke="#2e6bd9" stroke-width="2.5" stroke-dasharray="10 6" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="elastic" fill="none" stroke="#8a3d0a" stroke-width="2.5" stroke-dasharray="6 6" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="offsetLine" fill="none" stroke="#1d1a12" stroke-width="2" stroke-dasharray="4 6" stroke-linecap="round" stroke-linejoin="round" />
              <circle id="yieldPoint" class="yield-point" r="5" />
              <g id="points"></g>
            </svg>
          </div>

          <div class="chart-subhead">
            <h3>Region fit</h3>
            <div class="plot-selector">
              <label for="regionFitSelect" title="Choose the regression model for the region fit plot.">Regression</label>
              <select id="regionFitSelect" title="Choose the regression model for the region fit plot.">
                <option value="none">None</option>
                <option value="linear" selected>Linear</option>
                <option value="quadratic">Quadratic</option>
                <option value="cubic">Cubic</option>
                <option value="exponential">Exponential</option>
              </select>
            </div>
            <p id="modulus" class="modulus" title="Young's Modulus is computed from the full dataset (auto elastic fit), not the selected range.">Young's Modulus: --</p>
            <p id="yieldPointText" class="modulus">Yield (0.2%): --</p>
            <p id="utsText" class="modulus">UTS: --</p>
            <p id="hardeningText" class="modulus">Power hardening: --</p>
            <p id="regionFitLine" class="modulus">Regression: --</p>
            <p id="regionFitCubic" class="modulus">R2: --</p>
            <p id="elasticSummary">Awaiting fit segment...</p>
          </div>

          <div class="chart-shell">
            <svg id="elasticChart" viewBox="0 0 640 400" role="img" aria-label="Region fit chart">
              <rect x="0" y="0" width="640" height="400" class="chart-bg" />
              <g id="elasticGrid"></g>
              <g id="elasticAxes"></g>
              <polyline id="elasticCurve" fill="none" stroke="#d8722a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="elasticFit" fill="none" stroke="#1d1a12" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
              <g id="elasticPoints"></g>
            </svg>
          </div>

          <div id="hardeningPanel" class="chart-subhead">
            <h3>Power hardening fit (log-log)</h3>
            <p id="hardeningSummary">Awaiting plastic range...</p>
          </div>

          <div id="hardeningChartShell" class="chart-shell">
            <svg id="hardeningChart" viewBox="0 0 640 400" role="img" aria-label="Power hardening fit chart">
              <rect x="0" y="0" width="640" height="400" class="chart-bg" />
              <g id="hardeningGrid"></g>
              <g id="hardeningAxes"></g>
              <polyline id="hardeningCurve" fill="none" stroke="#8a3d0a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="hardeningFit" fill="none" stroke="#1d1a12" stroke-width="2.5" stroke-dasharray="6 6" stroke-linecap="round" stroke-linejoin="round" />
              <g id="hardeningPoints"></g>
            </svg>
          </div>

          <div id="plasticPanel" class="chart-subhead">
            <h3>Plastic region cubic fit</h3>
            <p id="plasticSummary">Awaiting plastic region data...</p>
          </div>

          <div id="plasticChartShell" class="chart-shell">
            <svg id="plasticChart" viewBox="0 0 640 400" role="img" aria-label="Plastic region cubic fit chart">
              <rect x="0" y="0" width="640" height="400" class="chart-bg" />
              <g id="plasticGrid"></g>
              <g id="plasticAxes"></g>
              <polyline id="plasticCurve" fill="none" stroke="#d8722a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
              <polyline id="plasticFit" fill="none" stroke="#1d1a12" stroke-width="2.5" stroke-dasharray="6 6" stroke-linecap="round" stroke-linejoin="round" />
              <g id="plasticPoints"></g>
            </svg>
          </div>
        </section>
      </main>
    </div>

    <script src="app.js?v=57"></script>
  </body>
</html>
